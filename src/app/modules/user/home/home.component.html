<section class="lg:p-8 p-2">
  @if(isLoading()) {
  <app-loading></app-loading>
  } @else {
  <ng-container *ngTemplateOutlet="mainTemplate"></ng-container>
  }
</section>

<ng-template #mainTemplate>
  <div class="mb-4">
    <div class="mr-2">
      <div class="mb-5">
        <app-title [text]="title" [icon]="icon"></app-title>
      </div>

      <div class="py-2 flex items-center">
        <mat-form-field class="pr-4" appearance="fill">
          <mat-label>Filtrar</mat-label>
          <mat-select [formControl]="filter" (selectionChange)="filterRequests($event)">
            <mat-option value="all">Todos</mat-option>
            <mat-option value="today">Últimas 12 horas</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="pb-5">
          <mat-button-toggle-group>
            <mat-button-toggle checked (click)="filterRequestsType('all')">Lista de pedidos</mat-button-toggle>
            <mat-button-toggle (click)="filterRequestsType('favorites')">
              <mat-icon fontIcon="star" type="button" class="text-yellow-400 hover:cursor-pointer mr-1"></mat-icon>
              Favoritos
            </mat-button-toggle>
          </mat-button-toggle-group>
        </div>
      </div>

      <div class="text-start pl-2">
        <span class="text-gray-600 text-xs">{{ requestList.length }} {{ requestList.length > 1 ? ' pedidos encontrados' : 'pedido encontrado' }}</span>
      </div>

      <div class="w-full">
        <ng-container *ngTemplateOutlet="ListTemplate"></ng-container>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #ListTemplate>
  <div class="p-2">
    @for (item of requestList; track $index) {
    <mat-card class="px-4 py-1.5 mb-2" appearance="raised">
      <div class="flex">
        <div class="flex items-center px-2 hover:scale-125">
          <mat-icon fontIcon="star" type="button" class="hover:text-yellow-400 hover:cursor-pointer text-gray-400"
            matTooltip="Favoritar música" [ngClass]="{'text-yellow-400' : item.favorite }"
            (click)="favoriteRequest(item.id, item.favorite)"></mat-icon>
        </div>
        <div>
          <div>
            <span class="text-xs text-gray-500">{{ regex.convertToBRTime(item.created_at) }} - {{ item.user_name ?
              item.user_name : 'Anônimo' }}</span>
          </div>
          <div class="text-xs">
            <span>Música: {{ item.song_name }}</span>
          </div>
          <div class="text-xs">
            <span>Mesa: {{ item.table ? item.table : '---' }}</span>
          </div>
        </div>
      </div>
    </mat-card>
    }
  </div>
</ng-template>
