<section class="lg:p-8 p-2">
  @if(isLoading()) {
  <app-loading></app-loading>
  } @else {
  <ng-container *ngTemplateOutlet="mainTemplate"></ng-container>
  }
</section>

<ng-template #mainTemplate>
  <div class="mb-4">
    <div class="mr-2">
      <div class="lg:mb-5 mb-2">
        <app-title [text]="title" [icon]="icon"></app-title>
      </div>

      <div class="md:flex items-center">
        <div class="md:mr-4 mb-2 md:mb-0">
          <mat-button-toggle-group class="!rounded-lg !w-full">
            <mat-button-toggle checked (click)="filterRequestsType('all')" class="!w-full">Lista de
              pedidos</mat-button-toggle>
            <mat-button-toggle (click)="filterRequestsType('favorites')" class="!w-full">
              <mat-icon fontIcon="star" type="button" class="text-yellow-400 hover:cursor-pointer mr-1"></mat-icon>
              Favoritos
            </mat-button-toggle>
          </mat-button-toggle-group>
        </div>
        <div>

        </div>
        <div class="static">
          <select [formControl]="filter" (change)="filterRequests($event)"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full px-2.5 py-3">
            <option value="all">Todos</option>
            <option value="today">
              Hoje (Últimas 12 Horas)
            </option>
          </select>
        </div>
      </div>

      <div class="text-start pl-2 mb-2">
        <span class="text-gray-600 text-xs">{{ requestList.length }} {{ requestList.length > 1 ? ' pedidos encontrados'
          : 'pedido encontrado' }}</span>
      </div>

      <div class="w-full">
        <ng-container *ngTemplateOutlet="ListTemplate"></ng-container>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #ListTemplate>
  <div>
    @for (item of requestList; track $index) {
    <div class="w-full">
      <button matButton [matMenuTriggerFor]="menu" class="w-full text-start">
        <div class="flex wrap">
          <div class="text-sm rounded-t-lg bg-gray-400 text-white md:px-4 px-1 py-1 flex items-center font-medium mr-1">
            <span>{{ item.id }}</span>
          </div>

          @if(item.favorite) {
          <div
            class="text-sm rounded-t-lg bg-yellow-50 border-yellow-500 border-[1px]  md:px-4 px-1 flex items-center font-medium mr-1">
            <mat-icon fontIcon="star" type="button" class="text-yellow-400 mr-1"></mat-icon>
            <span class="text-sm text-yellow-600 font-medium">Favorito</span>
          </div>
          }

          @if(item.done) {
          <div
            class="text-sm rounded-t-lg bg-green-50 border-green-500 border-[1px]  md:px-4 px-1 flex items-center font-medium mr-2">
            <mat-icon fontIcon="done" type="button" class="text-green-400 mr-1"></mat-icon>
            <span class="text-sm text-green-600 font-medium">Tocada</span>
          </div>
          }

        </div>
        <div
          class="shadow-md mb-3 lg:px-4 py-1.5 p-2 hover:bg-gray-100 hover:scale-[101%] rounded-b-xl rounded-tl-none rounded-tr-xl border-[1px] border-gray-400"
          appearance="raised">
          <div class="flex">
            <div>
              <div>
                <span class="text-base text-gray-500">{{ regex.convertToBRTime(item.created_at) }} - {{ item.user_name ?
                  item.user_name : 'Anônimo' }}</span>
              </div>
              <div class="text-base">
                <span>Música: {{ item.song_name }}</span>
              </div>
              <div class="text-base">
                <span>Mesa: {{ item.table ? item.table : '---' }}</span>
              </div>
            </div>
          </div>
        </div>
      </button>
      <mat-menu #menu="matMenu" xPosition="before" class="!w-full">
        @if (item.done) {
        <button mat-menu-item (click)="update(item.id, 'undone')">
          <mat-icon fontIcon="done" type="button" class="!text-red-400"></mat-icon>
          Marcar como não tocado
        </button>
        }
        @if (!item.done) {
        <button mat-menu-item (click)="update(item.id, 'done')">
          <mat-icon fontIcon="done" type="button" class="!text-green-400"></mat-icon>
          Marcar como tocado
        </button>
        }
        @if (item.favorite) {
        <button mat-menu-item (click)="update(item.id, 'unfavorite')">
          <mat-icon fontIcon="star" type="button" class="!text-gray-400"></mat-icon>
          Remover dos favoritos
        </button>
        }
        @if (!item.favorite) {
        <button mat-menu-item (click)="update(item.id, 'favorite')">
          <mat-icon fontIcon="star" type="button" class="!text-yellow-400"></mat-icon>
          Adicionar aos favoritos
        </button>
        }

      </mat-menu>
    </div>
    }
  </div>
</ng-template>
