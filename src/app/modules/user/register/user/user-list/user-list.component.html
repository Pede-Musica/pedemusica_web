<section class="lg:p-8 p-2">

  <div class="mb-4 flex items-center justify-between">
    <div class="mr-2">
      <app-title [text]="title" [icon]="icon"></app-title>
    </div>
    <button mat-button routerLink="/in/users/new" class="!text-green-500 flex items-center"
      matTooltip="Adicionar novo usuário">
      <mat-icon>add</mat-icon>
      Adicionar</button>
  </div>

  <div class="mb-8 flex flex-wrap">
    <div class="lg:w-[150px] w-full lg:mr-4 mb-2">
      <label class="block text-sm font-medium text-gray-900">Ordem</label>
      <select id="order" (change)="filterOrder($event)" [value]="order"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
        <option selected value="asc">A → Z</option>
        <option value="desc">Z → A</option>
      </select>
    </div>

    <div class="lg:w-[150px] w-full lg:mr-4 mb-2">
      <label class="block text-sm font-medium text-gray-900">Tipo</label>
      <select id="type" (change)="filterType($event)" [value]="type"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
        <option value="">Todos</option>
        <option value="user">Usuários</option>
        <option value="producer">Produtores</option>
        <option value="customer">Clientes</option>
      </select>
    </div>

    <div class="lg:w-[300px] w-full mb-4">
      <label class="block text-sm font-medium text-gray-900">Pesquisar</label>
      <input type="text" (keyup)="filter($event)" [(ngModel)]="search" [ngModelOptions]="{standalone: true}"
        class="rounded-lg bg-gray-50 border text-gray-900 focus:ring-blue-500 focus:border-blue-500 block flex-1 w-full text-sm border-gray-300 p-2.5">
    </div>
  </div>

  @if(isLoading()) {
  <app-loading></app-loading>
  } @else {
  <ng-container *ngTemplateOutlet="mainTemplate"></ng-container>
  }
</section>

<ng-template #mainTemplate>

  <div class="mb-2">

    <table mat-table [dataSource]="userList">
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> </th>
        <td mat-cell *matCellDef="let element">
          @switch (element.is_active) {
            @case (true) {
              <app-badge-status color="green" text="Ativo"></app-badge-status>
            }
            @case (false) {
              <app-badge-status color="red" text="Inativo"></app-badge-status>
            }
          }
        </td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Nome </th>
        <td mat-cell *matCellDef="let element"> {{element.name ?? ''}} </td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef> E-mail (Usuário) </th>
        <td mat-cell *matCellDef="let element"> {{element.email}} </td>
      </ng-container>

      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef> Contato </th>
        <td mat-cell *matCellDef="let element">
          <div class="flex items-center">
            {{ regex.formatPhoneNumber(element.phone)}}
            <button mat-icon-button matTooltip="Copiar" [cdkCopyToClipboard]="element.phone">
              <mat-icon class="text-gray-500">content_copy</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  @if (userList.length === 0) {
  <div class="p-2">
    <app-zero-length text="Nenhum usuário encontrado"></app-zero-length>
  </div>
  }
  <mat-paginator (page)="pageEvent($event)" [length]="userTotal" [pageSize]="page_size"
    [pageSizeOptions]="[5, 10, 25, 100]" [pageIndex]="page_index"></mat-paginator>
</ng-template>
